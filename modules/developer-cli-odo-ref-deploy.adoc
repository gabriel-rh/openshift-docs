// Module included in the following assemblies:
//
// * cli_reference/developer_cli_odo/odo-cli-reference.adoc

:_content-type: REFERENCE
[id="odo-deploy_{context}"]
= odo deploy


You can use `odo` to deploy components in a manner similar to how they would be deployed using a CI/CD system.
First, `odo` builds the container images, and then it deploys the Kubernetes resources required to deploy the components.

When running the command `odo deploy`, `odo` searches for the default command of kind `deploy` in the Devfile, and executes this command.
The kind `deploy` is supported by the devfile format starting from version 2.2.0.

The `odo deploy` command is typically a _composite_ command, composed of several _apply_ commands:

* A command referencing an `image` component that, when applied, will build the image of the container to deploy, and then push it to its registry.
* A command referencing a link:https://devfile.io/docs/devfile/2.2.0/user-guide/adding-kubernetes-component-to-a-devfile.html[Kubernetes component] that, when applied, will create a Kubernetes resource in the cluster.

With the following example `devfile.yaml` file, a container image is built using the `Dockerfile` present in the directory.
The image is pushed to its registry and then a Kubernetes Deployment resource is created in the cluster, using this freshly built image.

.devfile.yaml
[source,yaml]
----
schemaVersion: 2.2.0
...
variables:
  CONTAINER_IMAGE: quay.io/phmartin/myimage
commands:
  - id: build-image
    apply:
      component: outerloop-build
  - id: deployk8s
    apply:
      component: outerloop-deploy
  - id: deploy
    composite:
      commands:
        - build-image
        - deployk8s
      group:
        kind: deploy
        isDefault: true
components:
  - name: outerloop-build
    image:
      imageName: "{{CONTAINER_IMAGE}}"
      dockerfile:
        uri: ./Dockerfile
        buildContext: ${PROJECTS_ROOT}
  - name: outerloop-deploy
    kubernetes:
      inlined: |
        kind: Deployment
        apiVersion: apps/v1
        metadata:
          name: my-component
        spec:
          replicas: 1
          selector:
            matchLabels:
              app: node-app
          template:
            metadata:
              labels:
                app: node-app
            spec:
              containers:
                - name: main
                  image: {{CONTAINER_IMAGE}}
----

The `uri` for the Dockerfile could also be an HTTP or HTTPS URL.

.Sample command
[source,terminal]
----
$ odo deploy
----

.Sample interactive mode
[source,terminal]
----
$ odo deploy
  __
 /  \__     Deploying the application using my-nodejs Devfile
 \__/  \    Namespace: my-percona-server-mongodb-operator
 /  \__/    odo version: v3.0.0-rc1
 \__/

↪ Building & Pushing Container: quay.io/pvala18/myimage
 •  Building image locally  ...
STEP 1/7: FROM quay.io/phmartin/node:17
STEP 2/7: WORKDIR /usr/src/app
--> Using cache b18c8d9f4c739a91e5430f235b7beaac913250bec8bfcae531a8e93c750cea87
--> b18c8d9f4c7
STEP 3/7: COPY package*.json ./
--> Using cache cd151181cd9b2c69fc938eb89f3f71d0327d27ffba53c54247a105733cb36217
--> cd151181cd9
STEP 4/7: RUN npm install
--> Using cache 72b79a4f76ab0f9665653a974f5c667b1cb964c89c58e71aa4817b1055b1c473
--> 72b79a4f76a
STEP 5/7: COPY . .
--> 5c81f92690e
STEP 6/7: EXPOSE 8080
--> 9892b562a8a
STEP 7/7: CMD [ "node", "server.js" ]
COMMIT quay.io/pvala18/myimage
--> 7578e3e3667
Successfully tagged quay.io/pvala18/myimage:latest
7578e3e36676418853c579063dd190c9d736114ca414e28c8646880b446a1618
 ✓  Building image locally [2s]
 •  Pushing image to container registry  ...
Getting image source signatures
Copying blob 0b3c02b5d746 skipped: already exists
Copying blob 62a747bf1719 skipped: already exists
Copying blob 650b52851ab5 done
Copying blob 013fc0144002 skipped: already exists
Copying blob aef6a4d33347 skipped: already exists
Copying config 7578e3e366 done
Writing manifest to image destination
Storing signatures
 ✓  Pushing image to container registry [22s]

↪ Deploying Kubernetes Component: my-component
 ✓  Creating kind Deployment 

Your Devfile has been successfully deployed
----

== Substituting variables

The Devfile can use variables to make the Devfile parameterizable. The Devfile can define values for these variables, and you can override the values for variables from the command line when running `odo deploy`, using the `--var` and `--var-file` options.

For more information, see the section "Substituting variables in odo dev".
