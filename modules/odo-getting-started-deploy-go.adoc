// Module included in the following assemblies:
//
// * cli_reference/developer_cli_odo/getting-started-with-odo/odo-getting-started-go.adoc

:_content-type: Procedure
[id="odo-getting-started-deploy-go_{context}"]

= Deploying your Go application

Use the `odo deploy` command to deploy your application.

.Prerequisites
* You have sample code for a Go application.
* You have logged in to your {product-title} cluster and created a project.
* You have initialized your application with `odo init`.
* You have started developing your application with `odo dev`.
* You have logged in to your image registry.
* You have configured the container build platform.

.Procedure
. *Containerize the application:* To deploy your application, you must containerize it to build and push it to a registry. Create the following Dockerfile in the same directory:
+
.Sample Dockerfile
[source, terminal]
----
# This Dockerfile is referenced from:
# https://github.com/GoogleCloudPlatform/golang-samples/blob/main/run/helloworld/Dockerfile

# Build
FROM golang:1.17-buster as builder
WORKDIR /app
COPY go.* ./
RUN go mod download
COPY . ./
RUN go build -v -o server

# Create a "lean" container
FROM debian:buster-slim
RUN set -x && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
    ca-certificates && \
    rm -rf /var/lib/apt/lists/*
COPY --from=builder /app/server /app/server

# Run
CMD ["/app/server"]
----

. *Modify the Devfile:* Edit the `devfile.yaml` and add the appropriate deployment code:
+
[WARNING]
====
When copying and pasting to `devfile.yaml`, verify that the lines you insert are correctly indented.
====
.. `odo deploy` uses Devfile schema 2.2.0. Change the schema to reflect the change:
+
[source, yaml]
----
# Deploy "kind" ID's use schema 2.2.0+
schemaVersion: 2.2.0
----

.. Add the variables section:
+
[source, yaml]
----
# Add the following variables code anywhere in devfile.yaml
# This MUST be a container registry you are able to access
variables:
  CONTAINER_IMAGE: quay.io/MYUSERNAME/go-odo-example
  RESOURCE_NAME: my-go-app
  CONTAINER_PORT: "8080"
  DOMAIN_NAME: go.example.com
----

include::snippets/odo-deploy-commands.adoc[]
include::snippets/odo-deploy-resources.adoc[]
include::snippets/odo-deploy-route.adoc[]

. *Run the odo deploy command:*
+
.Sample command
[source,terminal]
----
$ oc deploy
----
+
.Sample output
[source,terminal]
----
  __
 /  \__     Deploying the application using my-go-app Devfile
 \__/  \    Namespace: default
 /  \__/    odo version: v3.0.0-alpha2
 \__/

↪ Building & Pushing Container: MYUSERNAME/go-example
 •  Building image locally  ...
 ✓  Building image locally [880ms]
 •  Pushing image to container registry  ...
 ✓  Pushing image to container registry [5s]

↪ Deploying Kubernetes Component: go-example
 ✓  Searching resource in cluster
 ✓  Creating kind Deployment [48ms]

↪ Deploying Kubernetes Component: go-example
 ✓  Searching resource in cluster
 ✓  Creating kind Service [51ms]

↪ Deploying Kubernetes Component: go-example
 ✓  Searching resource in cluster
 ✓  Creating kind Ingress [49ms]

Your Devfile has been successfully deployed
----
+
[NOTE]
====
Depending on the image registry in the `devfile.yaml`, the access for the container image
pushed by `odo deploy` may be private by default. For example, for images pushed to link:https://quay.io[Quay.io], you might need to change the image visibility appropriately to run `odo deploy` successfully.
====
+
To test your application, visit the location from the `DOMAIN_NAME` variable in the `devfile.yaml`.
//+
//Use the `oc get routes` command to find the route URL. `odo` does not currently support retrieving the route.
//+
//.Sample command
//[source,terminal]
//----
//$ oc get routes
//----
//+
//.Sample output
//[source,terminal]
//----
//TODO
//----